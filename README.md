# Tyger - MRIlab

In this repository we have a first version of the use of Tyger for reconstruction and post-processing of magnetic resonance images acquired in systems controlled by MaRCoS and MaRGE. 

## RawDatas to test

In the following link you can download rawDatas generated by one of our low-field scanners. 

[RARE rawData](https://upvedues-my.sharepoint.com/:f:/g/personal/tguanav_upv_edu_es/Elbh3OZ_ZfFAhL5uM9vE67EBxpgND0rMQdgiC90w74gZ8w?e=5wpbZv)

[Knee and Brain rawDatas](https://upvedues-my.sharepoint.com/:f:/g/personal/tguanav_upv_edu_es/Em7Qqj6MAeBMhg2JriWJAc4BibaaqHXUXoEn9AbLJ3-w1w?e=fzlUjw)

## Testing - RARE
Python codes to execute.

- Tyger recon: `RARE_recon/run_files/runTyger.py`

- Local recon: `RARE_recon/run_files/runPythonFit.py`

Among the inputs for these codes, you must indicate the path to a yml file containing the reconstruction information. There are several examples in the path: `RARE_recon/yml_files/`.

## Testing - PETRA
Python codes to execute.

- Tyger recon: `PETRA_recon/run_files/runTyger.py`

- Local recon: `PETRA_recon/run_files/runPythonscripts_PETRA.py`

Among the inputs for these codes, you must indicate the path to a yml file containing the reconstruction information. There are several examples in the path: `PETRA_recon/yml_files/`.

## Testing - Brain
Here are some examples of use.

1. **FFT**:
    ```bash
    python3 recon_xyz/scripts/fromMATtoMRD3D_RARE.py -i 'brainIR.mat' | tyger run exec -f recon_xyz/scripts/stream_recon_FFT_gpu.yml | python3 recon_xyz/scripts/fromMRDtoMAT3D.py -o 'brainIR.mat'

    ```
2. **ART**: 
    ```bash
    python3 recon_xyz/scripts/fromMATtoMRD3D_RARE.py -i 'brainIR.mat' | tyger run exec -f recon_xyz/scripts/stream_recon_ART_gpu.yml | python3 recon_xyz/scripts/fromMRDtoMAT3D.py -o 'brainIR.mat'
    ```
3. **ART PK Bo**: 
    ```bash
    python3 recon_xyz/scripts/fromMATtoMRD3D_RARE.py -i 'brainIR.mat' | tyger run exec -f recon_xyz/scripts/stream_recon_ARTPK_gpu.yml | python3 recon_xyz/scripts/fromMRDtoMAT3D.py -o 'brainIR.mat'
    ```
4. **Conjugate Phase**: 
    ```bash
    python3 recon_xyz/scripts/fromMATtoMRD3D_RARE.py -i 'brainIR.mat' | tyger run exec -f recon_xyz/scripts/stream_recon_CP_gpu.yml | python3 recon_xyz/scripts/fromMRDtoMAT3D.py -o 'brainIR.mat'
    ```

## Testing - knee
Here are more examples of use.

1. **FFT**:
    ```bash
    python3 scripts/fromMATtoMRD2D.py -i 'knee.mat' -s 10 | tyger run exec -f scripts/stream_recon.yml | python3 scripts/fromMRDtoMAT2D.py -o 'knee.mat'
    ```
2. **ART**: 
    ```bash
    python3 scripts/fromMATtoMRD2D.py -i 'knee.mat' -s 10 | tyger run exec -f scripts/stream_recon_art.yml | python3 scripts/fromMRDtoMAT2D.py -o 'knee.mat'
    ```
3. **ART PK Grad**: 
    ```bash
    python3 scripts/fromMATtoMRD2D.py -i 'knee.mat' -s 10 | tyger run exec -f scripts/stream_recon_artPK.yml | python3 scripts/fromMRDtoMAT2D.py -o 'knee.mat'
    ```
4. **BART FFT**: 
    ```bash
    python3 scripts/fromMATtoMRD2D.py -i 'knee.mat' -s 10 | tyger run exec -f scripts/stream_recon_bart_fft.yml | python3 scripts/fromMRDtoMAT2D.py -o 'knee.mat'
    ```
5. **BART FFT undersampled**: 
    ```bash
    python3 scripts/fromMATtoMRD2D.py -i 'knee.mat' -s 10 | tyger run exec -f scripts/stream_recon_bart_fftus.yml | python3 scripts/fromMRDtoMAT2D.py -o 'knee.mat'
    ```
6. **BART Compressed Sensing**: 
    ```bash
    python3 scripts/fromMATtoMRD2D.py -i 'knee.mat' -s 10 | tyger run exec -f scripts/stream_recon_bart_cs.yml | python3 scripts/fromMRDtoMAT2D.py -o 'knee.mat'
    ```
7. **Pix2Pix knee model**: 
    ```bash
    python3 Pix2Pix_Tyger/scripts/fromMATtoMRD2D.py -i 'knee.mat' -s 17 | tyger run exec -f Pix2Pix_Tyger/scripts/stream_recon_pix2pix.yml | python3 Pix2Pix_Tyger/scripts/fromMRDtoMAT2D.py -o 'knee.mat'
    ```


## Docker images 

Docker images with code from this repository can be found here: 

[Docker Images](https://github.com/TeresaGuallartNaval?tab=packages)

These images are the ones that run on tyger. 


## References 
1. **Tyger**  
   [https://microsoft.github.io/tyger/](https://microsoft.github.io/tyger/)
2. **MRD**  
   [https://ismrmrd.github.io/mrd/](https://ismrmrd.github.io/mrd/)

